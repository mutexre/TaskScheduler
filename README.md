# **Оптимизация планирования задач**

Этот проект реализует алгоритм оптимального планирования задач с использованием линейного программирования (MILP) в `cvxpy`.
Цель - максимизировать награду за выполнение задач в срок при их последовательном выполнении на одном станке.

## **Структура проекта**

```
Scheduler/
├── scheduler/                         # Основная директория с логикой планировщика
│   ├── __init__.py                    # Инициализация модуля
│   ├── classes.py                     # Определение классов (Task, Schedule и др.)
│   ├── optimizer.py                   # Оптимизационный алгоритм для поиска лучшего расписания
│   └── util.py                        # Вспомогательные функции для работы с задачами и файлами
├── scripts/                           # Скрипты для запуска различных операций
│   ├── create_schedule.py             # Скрипт для создания оптимального расписания
│   └── random_tasks.py                # Генерация случайных задач и сохранение их в CSV
├── tests/                             # Тесты для проверки корректности работы планировщика
│   └── test_scheduler.py              # Модульные тесты для планировщика
├── data/                              # Каталог с входными данными (файлы CSV с задачами)
├── pyproject.toml                     # Конфигурационный файл проекта
├── README.md                          # Документация
└── requirements.txt                   # Список зависимостей Python для установки
```

## **Функциональность**
- Чтение списка задач из CSV-файла.
- Вычисление оптимальной последовательности выполнения задач для максимизации награды.
- Использование `cvxpy` и MILP-решателя (по умолчанию: `SCIP`) для решения задачи оптимизации.
- Поддержка сохранения рассчитанного расписания в CSV-файл.
- Командный интерфейс (CLI) с возможностью задания входных и выходных параметров.
- Включает юнит-тесты для проверки корректности работы алгоритма.
- Предоставляет информацию о том является ли найденное решение оптимальным или субоптимальным.
- Возможность ограничить время которое дается MIL-решателю на поиск решения.
- Включение/выключение вывода отладочной информации.
- Скрипт для генерации случайного набора задач с возможностью задания диапазона параметров: крайнего времени выполнения, длительности и награды.

## **Установка**
```bash
pip install .
```

## **Использование**
Запуск планировщика с входным CSV-файлом:

```bash
python -m scripts.create_schedule -i tasks.csv -o schedule.csv
```

Запуск с выводом дополнительной отладочной информации от CVXPY:
```bash
python -m scripts.create_schedule -i tasks.csv -o schedule.csv -v
```

Запуск с установленным лимитом времени выполнения (в секундах):
```bash
python -m scripts.create_schedule -i tasks.csv -o schedule.csv -t 10
```

## Пример списка задач и решения

| №  | Дедлайн | Длительность | Награда |
|----|---------|-------------|---------|
| 0  | 24      | 3           | 87      |
| 1  | 19      | 7           | 88      |
| 2  | 25      | 9           | 23      |
| 3  | 27      | 8           | 52      |
| 4  | 24      | 10          | 76      |
| 5  | 30      | 7           | 83      |
| 6  | 12      | 10          | 44      |
| 7  | 5       | 6           | 30      |

#### Schedule (```optimal_inaccurate```):

|Slot |  Task |  Start Time (s) | On Time  |  Reward  |
|-----|-------|-----------------|----------|----------|
|0    |  1    |  0              | True     |  88      |
|1    |  0    |  7              | True     |  87      | 
|2    |  2    |  10             | True     |  23      |
|3    |  3    |  19             | True     |  52      |
|4    |  4    |  27             | False    |  —       |
|5    |  5    |  37             | False    |  —       | 
|6    |  6    |  44             | False    |  —       |
|7    |  7    |  54             | False    |  —       |   

Total reward: 250

## **Аргументы командной строки**

Скрипт поддерживает следующие аргументы командной строки:

| Короткий | Длинный        | Обязательный | Тип    | По умолчанию | Описание |
|----------|----------------|--------------|--------|--------------|----------|
| `-i`     | `--input`      |  Да          | Строка | N/A          | Путь к входному CSV-файлу с задачами. |
| `-o`     | `--output`     |  Нет         | Строка | None         | Путь к выходному CSV-файлу для сохранения расписания. |
| `-t`     | `--max_time`   |  Нет         | Float  | None         | Максимальное время (в секундах), разрешённое для решения. |
| `-v`     | `--verbose`    |  Нет         | Флаг   | False        | Включить подробный вывод для отладки. |


## Пример входного файла в формате CSV
CSV-файл должен содержать данные в следующем формате:

```csv
deadline,duration,reward
29,2,1000
4,1,20
7,1,15
10,14,30
6,2,25
```

## Пример выходного расписания в формате CSV
После выполнения алгоритма результат сохранится в следующем виде:

```csv
task_index,start_time,on_time,reward
1,0,True,1000
2,2,True,20
3,3,True,15
5,4,False,25
4,6,False,30
```

## Детали реализации

Переменные решения:
- ```x[i, j]```: 1, если задача i запланирована на позицию j
- ```s[j]```: Время начала выполнения задачи в позиции j
- ```z[i]```: 1, если задача i завершена в срок

Ограничения:
- Каждая задача выполняется ровно один раз.
- Задачи выполняются последовательно.
- Для получения награды задачи должны быть выполнены в срок.

Целевая функция: максимизация общей награды.

## Тестирование

Для запуска юнит-тестов выполните:
```bash
python -m tests.test_scheduler
```
